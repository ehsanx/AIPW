<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Augmented Inverse Probability Weighting (AIPW) for binary exposure and binary outcome â€¢ AIPW</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Augmented Inverse Probability Weighting (AIPW) for binary exposure and binary outcome">
<meta property="og:description" content="Augmented Inverse Probability Weighting (AIPW) is a doubly robust estimator for causal inference. This pacakge implement the AIPW estimator for an binary exposure on a binary outcome with user-defined stacked machine learning algorithms.  ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-166939490-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-166939490-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">AIPW</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/AIPW.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/yqzhong7/AIPW/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="aipw-augmented-inverse-probability-weighting" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#aipw-augmented-inverse-probability-weighting" class="anchor"></a>AIPW: Augmented Inverse Probability Weighting</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<!-- README.md is generated from README.Rmd. Please edit that file -->
<p><strong>Authors:</strong> <a href="https://github.com/yqzhong7">Yongqi Zhong</a>, <a href="https://github.com/ainaimi">Ashley Naimi</a>, <a href="https://github.com/gconzuelo">Gabriel Conzuelo</a></p>
<hr>
<p>Augmented inverse probability weighting (AIPW) is a doubly robust estimator for causal inference. The <code>AIPW</code> package is designed for estimating the average treatment effect of a binary exposure on a binary outcome in risk difference (RD), risk ratio (RR) and odds ratio (OR), under the nonparametric structural equations (NPSEM) or structural causal model (SCM) framework. Users need to examine causal assumptions (e.g., consistency) before using this package.</p>
<hr>
<div id="contents" class="section level2">
<h2 class="hasAnchor">
<a href="#contents" class="anchor"></a>Contents:</h2>
<ul>
<li><h5 id="installation"><a href="#Installation">Installation</a></h5></li>
<li>
<h5 id="example"><a href="#Example">Example</a></h5>
<ul>
<li><h6 id="setup-example-data"><a href="#data">Setup example data</a></h6></li>
<li><h6 id="one-line-version"><a href="#one_line">One line version</a></h6></li>
</ul>
</li>
<li><h5 id="parallelization-and-progress-bar"><a href="#par">Parallelization and progress bar</a></h5></li>
<li><h5 id="use-tmletmle3-as-input"><a href="#tmle">Use tmle/tmle3 as input</a></h5></li>
<li><h5 id="references"><a href="#ref">References</a></h5></li>
</ul>
<hr>
</div>
<div id="installation-1" class="section level2">
<h2 class="hasAnchor">
<a href="#installation-1" class="anchor"></a><a id="Installation"></a>Installation</h2>
<div class="sourceCode" id="cb1"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"remotes"</span>)
<span class="kw pkg">remotes</span><span class="kw ns">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span>(<span class="st">"yqzhong7/AIPW"</span>)</pre></div>
</div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a><a id="Example"></a>Example</h2>
<div id="setup-example-data-1" class="section level3">
<h3 class="hasAnchor">
<a href="#setup-example-data-1" class="anchor"></a><a id="data"></a>Setup example data</h3>
<div class="sourceCode" id="cb2"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">888</span>)
<span class="no">N</span> <span class="kw">&lt;-</span> <span class="fl">200</span>
<span class="no">outcome</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">N</span>,<span class="fl">1</span>,<span class="fl">0.4</span>)
<span class="no">exposure</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">N</span>,<span class="fl">1</span>,<span class="fl">0.3</span>)
<span class="co">#covariates for both outcome model (Q) and exposure model (g)</span>
<span class="no">covariates</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span>(<span class="no">N</span>,<span class="fl">1</span>,<span class="fl">0.4</span>),
                       <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">N</span>,<span class="kw">mean</span> <span class="kw">=</span> <span class="fl">0</span>,<span class="kw">sd</span><span class="kw">=</span><span class="fl">1</span>),
                       <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span>(<span class="no">N</span>,<span class="kw">lambda</span> <span class="kw">=</span> <span class="fl">2</span>)),
                     <span class="kw">ncol</span><span class="kw">=</span><span class="fl">3</span>)

<span class="co"># covariates &lt;- c(rbinom(N,1,0.4)) #a vector of a single covariate is also supported</span></pre></div>
</div>
<div id="one-line-version-aipw-class-method-chaining-from-r6class" class="section level3">
<h3 class="hasAnchor">
<a href="#one-line-version-aipw-class-method-chaining-from-r6class" class="anchor"></a><a id="one_line"></a>One line version (<code>AIPW</code> class: method chaining from R6class)</h3>
<div class="sourceCode" id="cb3"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">AIPW</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">SuperLearner</span>)
<span class="co">#&gt; Loading required package: nnls</span>
<span class="co">#&gt; Super Learner</span>
<span class="co">#&gt; Version: 2.0-26</span>
<span class="co">#&gt; Package created on 2019-10-27</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="no">AIPW_SL</span> <span class="kw">&lt;-</span> <span class="no">AIPW</span>$<span class="fu">new</span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>,
                    <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,
                    <span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                    <span class="kw">Q.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">g.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">k_split</span> <span class="kw">=</span> <span class="fl">3</span>,
                    <span class="kw">verbose</span><span class="kw">=</span><span class="fl">FALSE</span>)$
  <span class="fu"><a href="reference/fit.html">fit</a></span>()$
  <span class="fu"><a href="reference/summary.html">summary</a></span>(<span class="kw">g.bound</span> <span class="kw">=</span> <span class="fl">0.25</span>)$
  <span class="fu"><a href="reference/plot.p_score.html">plot.p_score</a></span>()</pre></div>
<p><img src="reference/figures/one_line-1.png"><!-- --></p>
<p>To see the results, set <code>verbose = TRUE</code>(default) or:</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">AIPW_SL</span>$<span class="no">result</span>
<span class="co">#&gt;                   Estimate        SE    95% LCL    95% UCL   N</span>
<span class="co">#&gt; Risk Difference -0.1319084 0.1076637 -0.3429293 0.07911247 200</span>
<span class="co">#&gt; Risk Ratio       0.7280326 0.2528325  0.4435427 1.19499521 200</span>
<span class="co">#&gt; Odds Ratio       0.5795789 0.4451837  0.2421946 1.38694937 200</span></pre></div>
<p>You can also use the <code><a href="reference/aipw_wrapper.html">aipw_wrapper()</a></code> to wrap <code>new()</code>, <code><a href="reference/fit.html">fit()</a></code> and <code><a href="reference/summary.html">summary()</a></code> together (also support method chaining):</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">AIPW_SL</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/aipw_wrapper.html">aipw_wrapper</a></span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>,
                        <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,
                        <span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                        <span class="kw">Q.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                        <span class="kw">g.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                        <span class="kw">k_split</span> <span class="kw">=</span> <span class="fl">3</span>,
                        <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>)$<span class="fu"><a href="reference/plot.p_score.html">plot.p_score</a></span>()</pre></div>
</div>
</div>
<div id="parallelization-with-future-apply-and-progress-bar-with-progressr" class="section level2">
<h2 class="hasAnchor">
<a href="#parallelization-with-future-apply-and-progress-bar-with-progressr" class="anchor"></a><a id="par"></a>Parallelization with <code>future.apply</code> and progress bar with <code>progressr</code>
</h2>
<p>In default setting, the <code>AIPW$fit()</code> method will be run sequentially. The current version of AIPW package supports parallel processing implemented by <a href="https://github.com/HenrikBengtsson/future.apply">future.apply</a> package under the <a href="https://github.com/HenrikBengtsson/future">future</a> framework. Simply use <code><a href="https://rdrr.io/pkg/future/man/plan.html">future::plan()</a></code> to enable parallelization and <code><a href="https://rdrr.io/r/base/Random.html">set.seed()</a></code> to take care of the random number generation (RNG) problem:</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="co">###Additional steps for parallel processing###</span>
<span class="co"># install.packages("future.apply")</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future.apply</span>)
<span class="co">#&gt; Loading required package: future</span>
<span class="kw pkg">future</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="no">multiprocess</span>, <span class="kw">workers</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">gc</span><span class="kw">=</span><span class="no">T</span>)
<span class="co">#&gt; Warning: [ONE-TIME WARNING] Forked processing ('multicore') is disabled</span>
<span class="co">#&gt; in future (&gt;= 1.13.0) when running R from RStudio, because it is</span>
<span class="co">#&gt; considered unstable. Because of this, plan("multicore") will fall</span>
<span class="co">#&gt; back to plan("sequential"), and plan("multiprocess") will fall back to</span>
<span class="co">#&gt; plan("multisession") - not plan("multicore") as in the past. For more details,</span>
<span class="co">#&gt; how to control forked processing or not, and how to silence this warning in</span>
<span class="co">#&gt; future R sessions, see ?future::supportsMulticore</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">888</span>)

<span class="co">###Same procedure for AIPW as described above###</span>
<span class="no">AIPW_SL</span> <span class="kw">&lt;-</span> <span class="no">AIPW</span>$<span class="fu">new</span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>,
                    <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,
                    <span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                    <span class="kw">Q.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">g.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">k_split</span> <span class="kw">=</span> <span class="fl">3</span>,
                    <span class="kw">verbose</span><span class="kw">=</span><span class="fl">TRUE</span>)$<span class="fu"><a href="reference/fit.html">fit</a></span>()$<span class="fu"><a href="reference/summary.html">summary</a></span>()
<span class="co">#&gt; Done!</span>
<span class="co">#&gt;                 Estimate    SE 95% LCL 95% UCL   N</span>
<span class="co">#&gt; Risk Difference   -0.153 0.112  -0.372  0.0665 200</span>
<span class="co">#&gt; Risk Ratio         0.701 0.259   0.422  1.1640 200</span>
<span class="co">#&gt; Odds Ratio         0.534 0.469   0.213  1.3377 200</span></pre></div>
<p>Progress bar that supports parallel processing is available in the <code>AIPW$fit()</code> method through the API from <a href="https://github.com/HenrikBengtsson/progressr">progressr</a> package:</p>
<div class="sourceCode" id="cb7"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">progressr</span>)
<span class="co">#define the type of progress bar</span>
<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/handlers.html">handlers</a></span>(<span class="st">"progress"</span>)
<span class="co">#reporting through progressr::with_progress() which is embedded in the AIPW$fit() method</span>
<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/with_progress.html">with_progress</a></span>(
  <span class="no">AIPW_SL</span> <span class="kw">&lt;-</span> <span class="no">AIPW</span>$<span class="fu">new</span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>,
                    <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,
                    <span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                    <span class="kw">Q.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">g.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                    <span class="kw">k_split</span> <span class="kw">=</span> <span class="fl">3</span>,
                    <span class="kw">verbose</span><span class="kw">=</span><span class="fl">FALSE</span>)$<span class="fu"><a href="reference/fit.html">fit</a></span>()$<span class="fu"><a href="reference/summary.html">summary</a></span>()
)
<span class="co">#also available for the wrapper</span>
<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/with_progress.html">with_progress</a></span>(
  <span class="no">AIPW_SL</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/aipw_wrapper.html">aipw_wrapper</a></span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>,
                        <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,
                        <span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                        <span class="kw">Q.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                        <span class="kw">g.SL.library</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                        <span class="kw">k_split</span> <span class="kw">=</span> <span class="fl">3</span>,
                        <span class="kw">verbose</span><span class="kw">=</span><span class="fl">FALSE</span>)
)</pre></div>
</div>
<div id="use-tmletmle3-fitted-object-as-input-aipw_tmle-class" class="section level2">
<h2 class="hasAnchor">
<a href="#use-tmletmle3-fitted-object-as-input-aipw_tmle-class" class="anchor"></a><a id="tmle"></a>Use <code>tmle</code>/<code>tmle3</code> fitted object as input (<code>AIPW_tmle</code> class)</h2>
<p><code>AIPW_tmle</code> class is designed for using <code>tmle</code>/<code>tmle3</code> fitted object as input</p>
<div id="tmle" class="section level4">
<h4 class="hasAnchor">
<a href="#tmle" class="anchor"></a>1. <code>tmle</code>
</h4>
<p>As shown in the message, <a href="https://cran.r-project.org/web/packages/tmle/index.html">tmle</a> alone does not support sample splitting. In addition, <code>tmle</code> does not support different covariate sets for the exposure and the outcome models, respectively.</p>
<div class="sourceCode" id="cb8"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">tmle</span>)
<span class="co">#&gt; Loading required package: tmle</span>
<span class="co">#&gt; Loading required package: glmnet</span>
<span class="co">#&gt; Loading required package: Matrix</span>
<span class="co">#&gt; Loaded glmnet 4.0</span>
<span class="co">#&gt; Welcome to the tmle package, version 1.4.0.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Use tmleNews() to see details on changes and bug fixes</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">SuperLearner</span>)
<span class="no">tmle_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tmle/man/tmle.html">tmle</a></span>(<span class="kw">Y</span> <span class="kw">=</span> <span class="no">outcome</span>, <span class="kw">A</span> <span class="kw">=</span> <span class="no">exposure</span>,<span class="kw">W</span> <span class="kw">=</span> <span class="no">covariates</span>,
                 <span class="kw">Q.SL.library</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                 <span class="kw">g.SL.library</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SL.mean"</span>,<span class="st">"SL.glm"</span>),
                 <span class="kw">family</span><span class="kw">=</span><span class="st">"binomial"</span>)
<span class="no">AIPW_tmle</span>$
  <span class="fu">new</span>(<span class="kw">A</span><span class="kw">=</span><span class="no">exposure</span>,<span class="kw">Y</span><span class="kw">=</span><span class="no">outcome</span>,<span class="kw">tmle_fit</span> <span class="kw">=</span> <span class="no">tmle_fit</span>,<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)$
  <span class="fu"><a href="reference/summary.html">summary</a></span>(<span class="kw">g.bound</span><span class="kw">=</span><span class="fl">0.025</span>)
<span class="co">#&gt; Sample splitting was not supported with a fitted tmle object</span>
<span class="co">#&gt;                 Estimate    SE 95% LCL 95% UCL   N</span>
<span class="co">#&gt; Risk Difference   -0.129 0.106  -0.337  0.0778 200</span>
<span class="co">#&gt; Risk Ratio         0.720 0.259   0.433  1.1975 200</span>
<span class="co">#&gt; Odds Ratio         0.580 0.442   0.244  1.3809 200</span></pre></div>
</div>
<div id="tmle3" class="section level4">
<h4 class="hasAnchor">
<a href="#tmle3" class="anchor"></a>2. <code>tmle3</code>
</h4>
<p>Similarly, <a href="https://github.com/tlverse/tmle3">tmle3</a> may not support different covariate sets for the exposure and the outcome models, respectively. However, <code>tmle3</code> conducts sample splitting and propensity truncation (0.025) by default.</p>
<div class="sourceCode" id="cb9"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sl3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tmle3</span>)
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">exposure</span>,<span class="no">outcome</span>,<span class="no">covariates</span>)
<span class="no">node_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">A</span> <span class="kw">=</span> <span class="st">"exposure"</span>,<span class="kw">Y</span> <span class="kw">=</span> <span class="st">"outcome"</span>,<span class="kw">W</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">df</span>)[-<span class="fl">1</span>:-<span class="fl">2</span>])
<span class="no">or_spec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://tlverse.org/tmle3/reference/tmle_OR.html">tmle_OR</a></span>(<span class="kw">baseline_level</span> <span class="kw">=</span> <span class="st">"0"</span>,<span class="kw">contrast_level</span> <span class="kw">=</span> <span class="st">"1"</span>)
<span class="no">tmle_task</span> <span class="kw">&lt;-</span> <span class="no">or_spec</span>$<span class="fu">make_tmle_task</span>(<span class="no">df</span>,<span class="no">node_list</span>)
<span class="no">lrnr_glm</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_glm</span>)
<span class="no">lrnr_mean</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_mean</span>)
<span class="no">sl</span> <span class="kw">&lt;-</span> <span class="no">Lrnr_sl</span>$<span class="fu">new</span>(<span class="kw">learners</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">lrnr_glm</span>,<span class="no">lrnr_mean</span>))
<span class="no">learner_list</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">A</span> <span class="kw">=</span> <span class="no">sl</span>, <span class="kw">Y</span> <span class="kw">=</span> <span class="no">sl</span>)
<span class="no">tmle3_fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="http://tlverse.org/tmle3/reference/tmle3.html">tmle3</a></span>(<span class="no">or_spec</span>, <span class="kw">data</span><span class="kw">=</span><span class="no">df</span>, <span class="no">node_list</span>, <span class="no">learner_list</span>)

<span class="co"># parse tmle3_fit into AIPW_tmle class</span>
<span class="no">AIPW_tmle</span>$
  <span class="fu">new</span>(<span class="kw">A</span><span class="kw">=</span><span class="no">df</span>$<span class="no">exposure</span>,<span class="kw">Y</span><span class="kw">=</span><span class="no">df</span>$<span class="no">outcome</span>,<span class="kw">tmle_fit</span> <span class="kw">=</span> <span class="no">tmle3_fit</span>,<span class="kw">verbose</span> <span class="kw">=</span> <span class="fl">TRUE</span>)$
  <span class="fu"><a href="reference/summary.html">summary</a></span>()</pre></div>
<hr>
</div>
<div id="references-1" class="section level3">
<h3 class="hasAnchor">
<a href="#references-1" class="anchor"></a><a id="ref"></a>References:</h3>
<p>Robins, J.M., Rotnitzky, A. and Zhao, L.P., 1994. Estimation of regression coefficients when some regressors are not always observed. Journal of the American statistical Association, 89(427), pp.846-866.</p>
<p>Glynn, A.N. and Quinn, K.M., 2010. An introduction to the augmented inverse propensity weighted estimator. Political analysis, 18(1), pp.36-56.</p>
<p>Pearl, J., 2009. Causality. Cambridge university press.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/yqzhong7/AIPW/">https://â€‹github.com/â€‹yqzhong7/â€‹AIPW/â€‹</a>
</li>
<li>Report a bug at <br><a href="https://github.com/yqzhong7/AIPW/issues">https://â€‹github.com/â€‹yqzhong7/â€‹AIPW/â€‹issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/yqzhong7">Yongqi Zhong</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-4042-7450" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://github.com/ainaimi">Ashley Naimi</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-1510-8175" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://github.com/gconzuelo">Gabriel Conzuelo</a> <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#WIP"><img src="https://www.repostatus.org/badges/latest/wip.svg" alt="Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public."></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://codecov.io/gh/yqzhong7/AIPW?branch=master"><img src="https://codecov.io/gh/yqzhong7/AIPW/branch/master/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://travis-ci.com/yqzhong7/AIPW"><img src="https://travis-ci.com/yqzhong7/AIPW.svg?branch=master" alt="Travis build status"></a></li>
<li><a href="https://github.com/yqzhong7/AIPW/actions"><img src="https://github.com/yqzhong7/AIPW/workflows/R-CMD-check/badge.svg" alt="R build status"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://github.com/yqzhong7">Yongqi Zhong</a>, <a href="https://github.com/ainaimi">Ashley Naimi</a>, <a href="https://github.com/gconzuelo">Gabriel Conzuelo</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'fdb17ce3606ec3425c318a7950c6cf48',
    indexName: 'aipw',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
